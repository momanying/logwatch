-- 创建test_db数据库
CREATE DATABASE IF NOT EXISTS test_db;

-- 切换到test_db数据库
USE test_db;

-- 创建kv_7表
CREATE TABLE IF NOT EXISTS kv_7
(
    data_time     DateTime,
    write_time    DateTime,
    time_hour     String,
    id            String,
    time          Int64,
    extra         String DEFAULT '',
    entrance_time Int64 DEFAULT 0,
    entrance_id   String DEFAULT '',
    stamp         Int32 DEFAULT 0,
    app_id        String DEFAULT '',
    platform      String DEFAULT '',
    user_id       String DEFAULT '',
    version       String DEFAULT '',
    build_id      String DEFAULT '',
    device_id     String DEFAULT '',
    model         String DEFAULT '',
    os            String DEFAULT '',
    os_ver        String DEFAULT '',
    sdk_ver       String DEFAULT '',
    category      String DEFAULT '',
    action        String DEFAULT '',
    label         String DEFAULT '',
    state         String DEFAULT '',
    value         Int32 DEFAULT 0,
    level         String DEFAULT '',
    -- 额外字段
    d1  String DEFAULT '',
    d2  String DEFAULT '',
    d3  String DEFAULT '',
    d4  String DEFAULT '',
    d5  String DEFAULT '',
    d6  String DEFAULT '',
    d7  String DEFAULT '',
    d8  String DEFAULT '',
    d9  String DEFAULT '',
    d10 String DEFAULT '',
    d11 String DEFAULT '',
    d12 String DEFAULT '',
    d13 String DEFAULT '',
    d14 String DEFAULT '',
    d15 String DEFAULT '',
    d16 String DEFAULT '',
    d17 String DEFAULT '',
    d18 String DEFAULT '',
    d19 String DEFAULT '',
    d20 String DEFAULT '',
    d21 String DEFAULT '',
    d22 String DEFAULT '',
    d23 String DEFAULT '',
    d24 String DEFAULT '',
    d25 String DEFAULT '',
    d26 String DEFAULT '',
    d27 String DEFAULT '',
    d28 String DEFAULT '',
    d29 String DEFAULT '',
    d30 String DEFAULT '',
    d31 String DEFAULT '',
    d32 String DEFAULT '',
    d33 String DEFAULT '',
    d34 String DEFAULT '',
    d35 String DEFAULT '',
    d36 String DEFAULT '',
    d37 String DEFAULT '',
    d38 String DEFAULT '',
    d39 String DEFAULT '',
    d40 String DEFAULT '',
    -- 数值字段
    v1  Int64 DEFAULT 0,
    v2  Int64 DEFAULT 0,
    v3  Int64 DEFAULT 0,
    v4  Int64 DEFAULT 0,
    v5  Int64 DEFAULT 0,
    v6  Int64 DEFAULT 0,
    v7  Int64 DEFAULT 0,
    v8  Int64 DEFAULT 0,
    v9  Int64 DEFAULT 0,
    v10 Int64 DEFAULT 0,
    v11 Int64 DEFAULT 0,
    v12 Int64 DEFAULT 0,
    v13 Int64 DEFAULT 0,
    v14 Int64 DEFAULT 0,
    v15 Int64 DEFAULT 0,
    v16 Int64 DEFAULT 0,
    v17 Int64 DEFAULT 0,
    v18 Int64 DEFAULT 0,
    v19 Int64 DEFAULT 0,
    v20 Int64 DEFAULT 0,
    v21 Int64 DEFAULT 0,
    v22 Int64 DEFAULT 0,
    v23 Int64 DEFAULT 0,
    v24 Int64 DEFAULT 0,
    v25 Int64 DEFAULT 0,
    v26 Int64 DEFAULT 0,
    v27 Int64 DEFAULT 0,
    v28 Int64 DEFAULT 0,
    v29 Int64 DEFAULT 0,
    v30 Int64 DEFAULT 0,
    v31 Int64 DEFAULT 0,
    v32 Int64 DEFAULT 0,
    v33 Int64 DEFAULT 0,
    v34 Int64 DEFAULT 0,
    v35 Int64 DEFAULT 0,
    v36 Int64 DEFAULT 0,
    v37 Int64 DEFAULT 0,
    v38 Int64 DEFAULT 0,
    v39 Int64 DEFAULT 0,
    v40 Int64 DEFAULT 0,
    -- 信息字段
    info1  String DEFAULT '',
    info2  String DEFAULT '',
    info3  String DEFAULT '',
    info4  String DEFAULT '',
    info5  String DEFAULT '',
    info6  String DEFAULT '',
    info7  String DEFAULT '',
    info8  String DEFAULT '',
    info9  String DEFAULT '',
    info10 String DEFAULT '',
    -- 用户数据字段
    ud1  String DEFAULT '',
    ud2  String DEFAULT '',
    ud3  String DEFAULT '',
    ud4  String DEFAULT '',
    ud5  String DEFAULT '',
    ud6  String DEFAULT '',
    ud7  String DEFAULT '',
    ud8  String DEFAULT '',
    ud9  String DEFAULT '',
    ud10 String DEFAULT '',
    ud11 String DEFAULT '',
    ud12 String DEFAULT '',
    ud13 String DEFAULT '',
    ud14 String DEFAULT '',
    ud15 String DEFAULT '',
    ud16 String DEFAULT '',
    ud17 String DEFAULT '',
    ud18 String DEFAULT '',
    ud19 String DEFAULT '',
    ud20 String DEFAULT '',
    -- 用户数值字段
    uv1  Int64 DEFAULT 0,
    uv2  Int64 DEFAULT 0,
    uv3  Int64 DEFAULT 0,
    uv4  Int64 DEFAULT 0,
    uv5  Int64 DEFAULT 0,
    uv6  Int64 DEFAULT 0,
    uv7  Int64 DEFAULT 0,
    uv8  Int64 DEFAULT 0,
    uv9  Int64 DEFAULT 0,
    uv10 Int64 DEFAULT 0,
    -- 会话数据字段
    sd1  String DEFAULT '',
    sd2  String DEFAULT '',
    sd3  String DEFAULT '',
    sd4  String DEFAULT '',
    sd5  String DEFAULT '',
    sd6  String DEFAULT '',
    sd7  String DEFAULT '',
    sd8  String DEFAULT '',
    sd9  String DEFAULT '',
    sd10 String DEFAULT '',
    sd11 String DEFAULT '',
    sd12 String DEFAULT '',
    sd13 String DEFAULT '',
    sd14 String DEFAULT '',
    sd15 String DEFAULT '',
    sd16 String DEFAULT '',
    sd17 String DEFAULT '',
    sd18 String DEFAULT '',
    sd19 String DEFAULT '',
    sd20 String DEFAULT '',
    -- 会话数值字段
    sv1  Int64 DEFAULT 0,
    sv2  Int64 DEFAULT 0,
    sv3  Int64 DEFAULT 0,
    sv4  Int64 DEFAULT 0,
    sv5  Int64 DEFAULT 0,
    sv6  Int64 DEFAULT 0,
    sv7  Int64 DEFAULT 0,
    sv8  Int64 DEFAULT 0,
    sv9  Int64 DEFAULT 0,
    sv10 Int64 DEFAULT 0
) ENGINE = MergeTree()
ORDER BY (data_time, id);

-- 创建插入一些测试数据
INSERT INTO kv_7 (data_time, write_time, time_hour, id, time, platform, category, action, os, user_id, app_id, version, d1, level)
VALUES
    ('2023-12-01 10:00:00', '2023-12-01 10:00:01', '2023-12-01 10', 'log_1701410400_1', 1701410400000, 'Web', 'USER_ACTION', 'login', 'Windows 10', 'user_1001', '腾讯云前端监控项目Web-?20000.2:demo', '1.0.1', '用户登录成功', 'INFO'),
    ('2023-12-01 10:15:00', '2023-12-01 10:15:01', '2023-12-01 10', 'log_1701411300_2', 1701411300000, 'iOS', 'PAGE_VIEW', 'view', 'iOS 16', 'user_1002', '腾讯云前端监控项目Web-?20000.2:demo', '1.1.0', '用户查看首页', 'INFO'),
    ('2023-12-01 10:30:00', '2023-12-01 10:30:01', '2023-12-01 10', 'log_1701412200_3', 1701412200000, 'Android', 'ERROR', 'crash', 'Android 13', 'user_1003', '腾讯云前端监控项目Web-?20000.2:demo', '1.0.5', '应用崩溃', 'ERROR'),
    ('2023-12-01 11:00:00', '2023-12-01 11:00:01', '2023-12-01 11', 'log_1701414000_4', 1701414000000, 'Web', 'USER_ACTION', 'click', 'Windows 10', 'user_1001', '腾讯云前端监控项目Web-?20000.2:demo', '1.0.1', '用户点击了登录按钮', 'INFO'),
    ('2023-12-01 11:15:00', '2023-12-01 11:15:01', '2023-12-01 11', 'log_1701414900_5', 1701414900000, 'iOS', 'WARNING', 'slowResponse', 'iOS 16', 'user_1002', '腾讯云前端监控项目Web-?20000.2:demo', '1.1.0', '接口响应缓慢', 'WARNING'),
    ('2023-12-01 11:30:00', '2023-12-01 11:30:01', '2023-12-01 11', 'log_1701415800_6', 1701415800000, 'Android', 'USER_ACTION', 'share', 'Android 13', 'user_1003', '腾讯云前端监控项目Web-?20000.2:demo', '1.0.5', '用户分享了文章', 'INFO'),
    ('2023-12-01 12:00:00', '2023-12-01 12:00:01', '2023-12-01 12', 'log_1701417600_7', 1701417600000, 'Web', 'PAGE_VIEW', 'view', 'Windows 10', 'user_1001', '腾讯云前端监控项目Web-?20000.2:demo', '1.0.1', '用户查看了设置页面', 'INFO'),
    ('2023-12-01 12:15:00', '2023-12-01 12:15:01', '2023-12-01 12', 'log_1701418500_8', 1701418500000, 'macOS', 'ERROR', 'exception', 'macOS 13', 'user_1004', '腾讯云前端监控项目Web-?20000.2:demo', '1.2.0', '未捕获的异常', 'ERROR'),
    ('2023-12-01 12:30:00', '2023-12-01 12:30:01', '2023-12-01 12', 'log_1701419400_9', 1701419400000, 'Web', 'USER_ACTION', 'logout', 'Windows 10', 'user_1001', '腾讯云前端监控项目Web-?20000.2:demo', '1.0.1', '用户退出登录', 'INFO'),
    ('2023-12-01 13:00:00', '2023-12-01 13:00:01', '2023-12-01 13', 'log_1701421200_10', 1701421200000, 'iOS', 'PAGE_VIEW', 'view', 'iOS 16', 'user_1002', '腾讯云前端监控项目Web-?20000.2:demo', '1.1.0', '用户查看了个人中心', 'INFO');

-- 创建测试用户并授权
CREATE USER IF NOT EXISTS test_user IDENTIFIED BY 'Adefault132!';
GRANT SELECT ON test_db.* TO test_user; 